Private Function ReducirImagen(imagen As String, maxSize As Long) As String
    Dim FileDes As Integer
    Dim FileName As String
    Dim pic As PictureBox
    Dim imgSize As Long
    Dim nuevoAncho As Integer
    Dim nuevoAlto As Integer
    Dim escala As Double

    ' 游댠 Guardar temporalmente la imagen BMP
    FileName = "C:\Temp\firma_temporal.bmp"
    FileDes = FreeFile
    Open FileName For Binary As #FileDes
    Put #FileDes, , imagen
    Close #FileDes

    ' 游댠 Cargar la imagen en un PictureBox
    Set pic = LoadPicture(FileName)
    
    ' 游댠 Obtener el tama침o original
    imgSize = FileLen(FileName)

    ' 游댠 Si la imagen supera el tama침o m치ximo, reducimos su tama침o
    If imgSize > maxSize Then
        escala = Sqr(maxSize * 8 / (pic.ScaleWidth * pic.ScaleHeight))
        nuevoAncho = pic.ScaleWidth * escala
        nuevoAlto = pic.ScaleHeight * escala

        ' Ajustamos el tama침o del PictureBox
        pic.Width = nuevoAncho
        pic.Height = nuevoAlto

        ' Guardamos la imagen nuevamente
        SavePicture pic.Image, "C:\Temp\firma_final.bmp"

        ' 游댠 Cargar la imagen reducida en un string para devolverla
        FileDes = FreeFile
        Open "C:\Temp\firma_final.bmp" For Binary As #FileDes
        ReducirImagen = String(FileLen("C:\Temp\firma_final.bmp"), 0)
        Get #FileDes, , ReducirImagen
        Close #FileDes
    Else
        ReducirImagen = imagen
    End If
End Function
