private byte[] EnsureMaxSize(Bitmap image, int maxDataSize, int maxFileSize)
{
    int width = image.Width;
    int height = image.Height;
    const int bmpHeaderSize = 54;

    while (true)
    {
        using (var ms = new MemoryStream())
        {
            image.Save(ms, ImageFormat.Bmp);
            byte[] imageData = ms.ToArray();
            int dataSize = imageData.Length - bmpHeaderSize;

            // âœ… Si la imagen ya cumple con los lÃ­mites, la retornamos
            if (imageData.Length <= maxFileSize && dataSize <= maxDataSize)
                return imageData;
        }

        // ðŸš¨ Evitamos reducir demasiado la imagen
        if (width < 50 || height < 50)
        {
            Console.WriteLine("âš ï¸ La imagen no puede reducirse mÃ¡s sin perder contenido.");
            break; // Nos quedamos con el tamaÃ±o mÃ¡s cercano posible
        }

        // ðŸ”¥ Reducimos la imagen en pasos mÃ¡s grandes si sigue fuera del lÃ­mite
        width = (int)(width * 0.85);
        height = (int)(height * 0.85);

        using (var resizedImage = new Bitmap(image, new Size(width, height)))
        {
            image = (Bitmap)resizedImage.Clone();
        }
    }

    // ðŸ”¥ Retornamos la versiÃ³n mÃ¡s reducida posible si no logramos llegar a 2048 bytes
    using (var ms = new MemoryStream())
    {
        image.Save(ms, ImageFormat.Bmp);
        return ms.ToArray();
    }
}