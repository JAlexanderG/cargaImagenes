using (var inputStream = image.OpenReadStream())
    using (var originalImage = new Bitmap(inputStream))
    {
        int width = originalImage.Width;
        int height = originalImage.Height;
        int maxByteFirma = 2048; // El mismo valor que usa LeadTools

        // ðŸ”¥ Simular el cÃ¡lculo de LeadTools para ajustar tamaÃ±o
        int valorTotal = (height * width) / 8;
        if (valorTotal > maxByteFirma)
        {
            int newWidth = (int)(Math.Sqrt(maxByteFirma * 8 * width / height)) + 200;
            int newHeight = (int)(newWidth * height / width);

            using (var resizedImage = new Bitmap(originalImage, new Size(newWidth, newHeight)))
            using (var memoryStream = new MemoryStream())
            {
                resizedImage.Save(memoryStream, ImageFormat.Bmp);
                imageData = memoryStream.ToArray();
            }
        }
        else
        {
            using (var memoryStream = new MemoryStream())
            {
                originalImage.Save(memoryStream, ImageFormat.Bmp);
                imageData = memoryStream.ToArray();
            }
        }
    }