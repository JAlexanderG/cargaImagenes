private byte[] EnsureMaxSize(System.Drawing.Image originalImage, int maxSize)
{
    int width = originalImage.Width;
    int height = originalImage.Height;

    // üî• Reducci√≥n progresiva de tama√±o hasta que est√© dentro del l√≠mite
    while (true)
    {
        using (var ms = new MemoryStream())
        {
            // Guardamos la imagen en BMP en el tama√±o actual
            originalImage.Save(ms, System.Drawing.Imaging.ImageFormat.Bmp);
            byte[] imageData = ms.ToArray();

            if (imageData.Length <= maxSize)
                return imageData; // ‚úÖ Ya cumple con el tama√±o, retornamos.

            // Si a√∫n supera el l√≠mite, reducimos en un 10%
            width = (int)(width * 0.9);
            height = (int)(height * 0.9);

            if (width < 1 || height < 1)
                throw new Exception("No se puede reducir m√°s la imagen sin perder contenido.");

            // Crear una nueva imagen redimensionada
            using (var resizedImage = new Bitmap(originalImage, new Size(width, height)))
            {
                originalImage = (System.Drawing.Image)resizedImage.Clone();
            }
        }
    }
}