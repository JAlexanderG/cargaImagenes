<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <input type="file" id="fileInput" accept="image/*">
    <div id="canvasContainer" style="width: 630px; height: 500px; overflow: auto; border: 1px solid black; position: relative;">
        <canvas id="canvas" width="1200" height="900" style="position: absolute; left: 0; top: 0;"></canvas>
    </div>
    <button id="cropButton" disabled>Recortar</button>
    <img id="croppedImage" style="display:none; border: 1px solid #000; margin-top: 10px;"/>
</body>
<script>
    document.getElementById("cropButton").addEventListener("click", function() {
    if (!isImageLoaded) return;

    let cropWidth = Math.abs(endX - startX);
    let cropHeight = Math.abs(endY - startY);
    let cropX = Math.min(startX, endX);
    let cropY = Math.min(startY, endY);

    if (cropWidth <= 0 || cropHeight <= 0) return;

    let croppedCanvas = document.createElement("canvas");
    let croppedCtx = croppedCanvas.getContext("2d");

    croppedCanvas.width = cropWidth;
    croppedCanvas.height = cropHeight;

    let realCropX = (cropX - imgX) / scale;
    let realCropY = (cropY - imgY) / scale;
    let realCropWidth = cropWidth / scale;
    let realCropHeight = cropHeight / scale;

    croppedCtx.drawImage(
        img,
        realCropX, realCropY, realCropWidth, realCropHeight,
        0, 0, cropWidth, cropHeight
    );

    croppedCanvas.toBlob(blob => {
        const formData = new FormData();
        formData.append("image", blob, "cropped.png");

        // ðŸ”¥ ObtÃ©n el nÃºmero desde el input
        let numero = document.getElementById("numeroInput").value;
        formData.append("numero", numero); // Agrega el nÃºmero al FormData

        // ðŸ”¥ ENVÃO DE LA IMAGEN + NÃšMERO AL BACKEND
        fetch("/Imagen/Guardar", { // AsegÃºrate de que la URL coincida con tu controlador
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            console.log("Imagen guardada con Ã©xito", data);
        })
        .catch(error => console.error("Error al enviar la imagen", error));
    }, "image/png");
});
</script>

</html>


